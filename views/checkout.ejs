<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Patrick+Hand&display=swap" rel="stylesheet">
    <!-- CSS -->
    <link rel="stylesheet" href="css/addcart.css">
    <title>Nadi'Miel Chamarel</title>
</head>
<body class="body">
    <!-- Navbar -->
    <div class="my_navbar">
        <nav class="navbar navbar-expand-md navbar-dark bg-warning text-dark" aria-label="Fourth navbar example">
            <div class="container-fluid container-fluid-flex">
                <div>
                    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarsExample04" aria-controls="navbarsExample04" aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                </div>
                
                <div class="collapse navbar-collapse" id="navbarsExample04">
                    <ul class="navbar-nav me-auto mb-2 mb-md-0">
                    <li class="nav-item">
                        <a class="nav-link nav-color hover-underline-animation" aria-current="page" href="/">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link nav-color hover-underline-animation" href="/products">Products</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link nav-color hover-underline-animation active_nav" href="recipe">Recipes</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link nav-color hover-underline-animation" href="/orders">Order</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link nav-color hover-underline-animation" href="/#contact-us">Contact Us</a>
                    </li>
                    </ul>
                </div>
            </div>
          </nav>
    </div>

    <!-- Add to Cart -->
    <div class="card">
        <div class="row">
            <div class="title">
                <div class="row">
                    <div class="col">
                        <h4 class="text-center"><b>Shopping Cart</b></h4>
                    </div>
                    <div class="col align-self-center text-right text-muted"></div>
                </div>
            </div>

            <div class="col-md-8 cart outerContainer">
            <!-- List products from cart here -->
                
            </div>
            <div class="col-md-4 summary">
                <div>
                    <h5><b>Summary</b></h5>
                </div>
                <hr>
                <!-- <div class="row">
                    <div class="col" style="padding-left:0;">ITEMS 3</div>
                </div> -->
                <form>
                    <p>Payment Options</p>
                    <select>
                        <option class="text-muted">Choose payment options</option>
                        <option class="text-muted">Pay with Cash On Delivery</option>
                        <option class="text-muted">Pay With Juice On Delivery</option>
                    </select>
                </form>
                <div class="row" style="border-top: 1px solid rgba(0,0,0,.1); padding: 2vh 0;">
                    <div class="col">TOTAL PRICE</div>
                    <div class="col text-right cart-total">0</div>
                </div> 
            </div>
            <div class="customer_form">
                <div>
                    <h2 class="title orange">Please enter your details</h2>
                </div>
                <form>
                    <div class="form-group form_spacing">
                        <label for="first_name_customer">First Name:</label>
                        <input type="text" class="form-control" name="first_name_customer" id="first_name_customer" placeholder="First Name" required>
                    </div>
                    <div class="form-group form_spacing">
                        <label for="last_name_customer">Last Name:</label>
                        <input type="text" class="form-control" name="last_name_customer" id="last_name_customer" placeholder="Last Name" required>
                    </div>
                    <div class="form-group form_spacing">
                        <label for="email_customer">Email:</label>
                        <input type="text" class="form-control" name="email_customer" id="email_customer" placeholder="Email" required>
                    </div>
                    <div class="form-group form_spacing">
                        <label for="phone_customer">Phone:</label>
                        <input type="number" class="form-control" name="phone_customer" id="phone_customer" placeholder="Phone" required>
                    </div>
                    <div class="form-group form_spacing">
                        <label for="address_customer">Address:</label>
                        <input type="text" class="form-control" name="address_customer" id="address_customer" placeholder="Address" required>
                    </div>
                    <div class="btn-customer">
                        <button type="submit" onclick="add_customer()" style="width: 115px;">Checkout</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    
 
    <script>
        //DummyDatabase
        let cartMenu = [
            {
                product_id: "1",
                category: "Meal",
                price: 100,
                product_name_fr: "Poulet",
                qty: 2,
            },
            {
                product_id: "2",
                category: "Meal",
                price: 200,
                product_name_fr: "Briyani",
                qty: 2,
            },
            {
                product_id: "3",
                category: "Snack",
                price: 50,
                product_name_fr: "Gateau Piment",
                qty: 2,
            },
            {
                product_id: "4",
                category: "Snack",
                price: 30,
                product_name_fr: "Boulettes",
                qty: 2,
            },
        ]

        // <div class="row border-top border-bottom innerContainer">
        //     <div class="row main align-items-center">
        //         <div class="col-2">
        //            <img class="img-fluid" src="https://i.imgur.com/1GrakTl.jpg">
        //         </div>
        //         <div class="col">
        //             <div class="row text-muted test_name"></div>
        //             <div class="row test_product"> </div>
        //         </div>
        //         <div class="col ">
        //             <input type="number" value="1" class="quantity" onchange="updateTotal()">
        //         </div>
        //         <div class="col cart-price">
        //             <span class="close"><i class="fa fa-trash" aria-hidden="true"></i></span>
        //         </div>

        //     </div>
        // </div>

        function display_products(){
            let cartItemContainer = document.getElementsByClassName('outerContainer')[0];

            let products = JSON.parse(sessionStorage.getItem("cart"));

            for (item of products){
                item = JSON.parse(item);

                let innerContainer = document.createElement('div');
                innerContainer.className = "row border-top border-bottom innerContainer";

                let row = document.createElement('div');
                row.className = "row main align-items-center";

                let img_div = document.createElement('div');
                img_div.className = "col-2"
                let img = document.createElement('img');
                //img.src = item.picture;
                img.src="https://i.imgur.com/1GrakTl.jpg";
                img_div.append(img);

                let product_div = document.createElement('div');
                product_div.className = "col";
                let product_name = document.createElement('div');
                product_name.className = "row";
                product_name.innerText = item.product_name_fr;
                let product_id = document.createElement('div');
                product_id.className = "row text-muted product-serial";
                product_id.innerText = create_product_serial(item.product_id);
                product_div.appendChild(product_name);
                product_div.appendChild(product_id);

                let qty_div = document.createElement('div');
                qty_div.className = "col";
                qty_div.innerHTML = `<input type="number" value=${item.qty} class="quantity" onchange="update_cart();">`;

                let price_div = document.createElement('div');
                price_div.className = "col cart-price";
                price_div.innerHTML = `Rs${parseInt(item.price)}&nbsp;&nbsp;&nbsp;<span class="close"><i class="fa fa-trash" aria-hidden="true"></i></span>`

                // row.append(img_div);
                row.appendChild(product_div);
                row.appendChild(qty_div);
                row.appendChild(price_div);

                innerContainer.append(row);
                cartItemContainer.append(innerContainer);
            }

            let removeCartItemButtons = document.getElementsByClassName('close')
            for(let i =0; i< removeCartItemButtons.length; i++){
            let button = removeCartItemButtons[i];
            button.addEventListener('click', function(event){
                let buttonClicker = event.target;
                buttonClicker.parentElement.parentElement.parentElement.parentElement.remove();
                update_cart();
            })
            }
        }

        function updateTotal(){
            let total = 0;
            let cartItemContainer = document.getElementsByClassName('outerContainer')[0]
            let cartRows = cartItemContainer.getElementsByClassName('innerContainer')
            for (let i = 0; i < cartRows.length; i++){
                let cartRow = cartRows[i]
                let priceElement = cartRow.getElementsByClassName('cart-price')[0];
                let quantityElement = cartRow.getElementsByClassName('quantity')[0];
                let price = parseFloat(priceElement.innerText.replace('Rs', ''));
                let quantity = parseFloat(quantityElement.value);
                total = total + (price * quantity);
            }
            document.getElementsByClassName('cart-total')[0].innerHTML = 'Rs ' + total.toLocaleString();
        }

        function update_cart(){
            let product_serials = document.getElementsByClassName('product-serial');
            let product_qty = document.getElementsByClassName('quantity');

            let cart = sessionStorage.getItem("cart");
            cart = JSON.parse(cart);

            for (i in product_serials){
                if (product_serials[i].innerText != undefined){
                    let product_id = convert_product_id_serial(product_serials[i].innerText);

                    for (k in cart){
                        item = JSON.parse(cart[k]);
                        if (item.product_id == product_id){
                            item.qty = product_qty[i].value;
                            cart[k] = JSON.stringify(item);
                            console.log(cart);
                            break;
                        }
                    }
                }
            }
            console.log(cart);
            sessionStorage.setItem("cart", JSON.stringify(cart));
            updateTotal();
        }

        function create_product_serial(product_id){
            return ("N" + product_id.toString().padStart(4, 0));
        }

        function convert_product_id_serial(product_serial){
            console.log(product_serial);
            return Number(product_serial.slice(1));
        }

        display_products();
        updateTotal();
    </script>



    <footer class=" text-center text-white" style="background-color: #fcbf56;">
        <!-- Grid container -->
        <div class="container p-4 pb-0">
            <!-- Section: Social media -->
            <section class="mb-4">
                <!-- Facebook -->
                <a href="https://www.facebook.com/NadiMiel/" target="_blank" style="text-decoration: none; margin: 15px;">
                <i class="fab fa-facebook-square fa-2x dark_brown"></i>
                </a>
        

                <!-- Instagram -->
                <a href="https://www.instagram.com/nadimiel_chamarel/?hl=en" target="_blank" style="text-decoration: none; margin: 15px;">
                <i class="fab fa-instagram-square fa-2x dark_brown"></i>
                </a>
        
            </section>
            <!-- Section: Social media -->
        </div>
        <!-- Grid container -->

        <!-- Copyright -->
        <div class="text-center p-3" style="background-color: #fbaa19">
        <span class="dark_brown">
            © 2022 Designed with <span style="color: red">❤</span> by
            <a class="dark_brown" href="https://developers.institute/mu/" style="text-decoration: none;">Developers Institute</a>
        </span>
        </div>
        <!-- Copyright -->
    </footer>
    
    <script src="js/checkout.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
</body>
</html>


